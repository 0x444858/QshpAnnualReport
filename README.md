# 清水河畔年度报告生成

在线使用：[获取您的清水河畔2025年度报告](https://qshp.range6.link/AnnualReport/)

> [!NOTE]  
> 在线域名被`Microsoft Smart Screen`误报，建议使用chrome等其他浏览器。

## 功能

生成指定清水河畔用户的年度报告，包含如下项目：

- 用户名
- UID
- 年度总发帖数
- 年度发表主题数
- 年度发表回复数
- 今年有多少天发帖
- 每天发帖量


- 今年第一个帖子
- 今年最后一个帖子
- 今年第一个回复
- 今年最后一个回复


- 今年总计被赞
- 今年总计被踩
- 被点赞最多的主题帖
- 被点赞最多的回复
- 被点踩最多的主题帖
- 被点踩最多的回复


- 回复最多的主题帖（你在哪个帖子回复最多）
- 被回复最多的主题帖（你发的帖子哪个被回复最多）
- 浏览量最多的帖子
- 被收藏最多的帖子


- 最喜欢的分区（你发表主题帖和回复总和，哪个版块最多）
- 回复最多的人（你回复谁的帖子回的最多）


- 被点赞的主题帖排行
- 被点踩的主题帖排行
- 被点赞的回复排行
- 被点踩的回复排行
- 回复主题帖数排行
- 被回复主题帖数排行
- 主题帖浏览量排行
- 主题帖收藏量排行
- 分区发帖排行
- 回复的人排行
- 每天发帖量排行

## 使用方法

新建`config.py`，填入以下内容并保存：

```python
username = '用户名'
password = '密码'
year = 2025
```

> [!WARNING]
> 请注意：不要将`main.py`中的`max_workers_*`变量
设为大于10的值， 以免对正常用户造成影响。
> 
> 如要测试，请在`main.py`中调小时间段，例如15天。

### 自用

执行`add_task.py uid1 uid2 ...`添加任务。

然后运行`main.py`，如果一切正确，会有如下日志：

```text
[Sat Dec 20 16:36:49 2025] 开始处理uid: 287813
[Sat Dec 20 16:37:20 2025] 获取到相关tid数: 4234
[Sat Dec 20 16:37:47 2025] 完成uid: 287813
[Sat Dec 20 16:37:47 2025] 报告生成完成: 287813
```

完成后按`CTRL` + `C`退出程序。

然后，在`data/user/{uid}/`文件夹中，`report.json`即为报告。

如要可视化，运行`web.py`，打开 `http://127.0.0.1:9595/AnnualReport` 即可。

### 部署为服务

运行`main.py`和`web.py`，配置好nginx。

支持通过自助的方式来添加计划任务，只是此功能未有前端入口。

如需启用，请在`user_status.html`的`apply_div`中进行引导并给出确认按钮以发送数据包。

1. 向爬虫账号私信任意内容。你也可以要求用户私信指定内容。

2. 向`/AnnualReport/api/new_task` `POST`如下格式的数据包来添加任务：

    ```json
    {
        "uid": 111,
        "auth": "刚刚私信的内容"
    }
    ```

你也随时可以收到通过`add_task.py`添加任务。
